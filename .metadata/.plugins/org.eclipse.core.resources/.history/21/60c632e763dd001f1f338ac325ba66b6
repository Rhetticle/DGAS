/*
 * gauge.h
 *
 *  Created on: Jan 26, 2025
 *      Author: rhett
 */

#ifndef INC_GAUGE_H_
#define INC_GAUGE_H_

#include <stm32f7xx.h>
#include <stdint.h>
#include "OBD2.h"

typedef struct {
	uint32_t min;
	uint32_t max;
	uint32_t step;
	char* units;
	char* name;
	HAL_StatusTypeDef (*measure) (OBDBus*, uint16_t*);
} GaugeParam;

typedef struct {
	OBDBus* bus;
	const GaugeParam* param;
	uint32_t max;
	float vBat;
} GaugeState;

extern const GaugeParam PARAM_RPM, PARAM_LOAD;


#define PARAM_MEAS_MAX_LEN 4 // maximum characters to be used to display a parameter measurement

#define ADC_TO_VOLTAGE(x) ((float)x /4096) * 15

void gauge_load_param(GaugeState* state, GaugeParam* const param);
void gauge_update(GaugeState* state, uint32_t measured);

#endif /* INC_GAUGE_H_ */
