/*
 * gauge.h
 *
 *  Created on: Jan 26, 2025
 *      Author: rhett
 */

#ifndef INC_GAUGE_H_
#define INC_GAUGE_H_

#include <stm32f7xx.h>
#include <stdint.h>
#include "OBD2.h"

typedef struct {
	uint32_t min;
	uint32_t max;
	uint32_t step;
	char* units;
	char* name;
	HAL_StatusTypeDef (*measure) (OBDBus*, uint16_t*);
} GaugeParam;

typedef struct {
	OBDBus* bus;
	const GaugeParam* param;
	uint32_t max;
	float vBat;
} GaugeState;

#define INIT_PARAM_RPM {.min = 0, .max = 4200, .step = 700, .units = "RPM", .name = "#FF0000 ENGINE SPEED", .measure = obd2_get_rpm};


#define PARAM_MEAS_MAX_LEN 4 // maximum characters to be used to display a parameter measurement



void gauge_set_param(GaugeParam* param);
void gauge_update(GaugeState* state, uint32_t measured);

#endif /* INC_GAUGE_H_ */
