/*
 * ST7701.c
 *
 *  Created on: Jan 4, 2025
 *      Author: rhett
 */

#include <stm32f7xx.h>
#include "ST7701.h"

extern SPI_HandleTypeDef hspi1;

HAL_StatusTypeDef lcd_command(uint16_t cmd, uint16_t arg) {
	uint8_t args[] = {cmd << 8, cmd, arg << 8, arg};

	HAL_GPIO_WritePin(GPIOB, LCD_CS, 0);
	if (HAL_SPI_Transmit(&hspi1, args, sizeof(uint32_t), 100) != HAL_OK) {
		HAL_GPIO_WritePin(GPIOB, LCD_CS, 1);
		return HAL_ERROR;
	}
	HAL_GPIO_WritePin(GPIOB, LCD_CS, 1);
	return HAL_OK;
}

void lcd_reset(void) {
	HAL_GPIO_WritePin(GPIOB, LCD_NRST, 0);
	HAL_Delay(10);
	HAL_GPIO_WritePin(GPIOB, LCD_NRST, 1);
	HAL_Delay(10);
}

HAL_StatusTypeDef lcd_init(void) {
	HAL_GPIO_WritePin(GPIOB, LCD_NRST, 1);
	HAL_GPIO_WritePin(GPIOB, LCD_CS, 1);
	lcd_reset();
	lcd_command(LCD_NORM_DISPLAY_ON, 0x0000);
	lcd_command(LCD_DISP_ON, 0x0000);
	lcd_command(LCD_ALL_PIX_ON, 0x0000);
	return HAL_OK;
}
