/*
 * OBD2.c
 *
 *  Created on: Jan 11, 2025
 *      Author: rhett
 */

#include <stm32f7xx.h>
#include "OBD2.h"

extern UART_HandleTypeDef huart4;

HAL_StatusTypeDef iso9141_init(void) {
	HAL_GPIO_WritePin(GPIOC, ISO9141_K, 1);
	HAL_Delay(3000); //must be no traffic on bus for 3 seconds after K goes high
	HAL_GPIO_WritePin(GPIOC, ISO9141_K, 0); // start bit
	HAL_Delay(200);
	HAL_GPIO_WritePin(GPIOC, ISO9141_K, 1);
	HAL_Delay(400);
	HAL_GPIO_WritePin(GPIOC, ISO9141_K, 0);
	HAL_Delay(400);
	HAL_GPIO_WritePin(GPIOC, ISO9141_K, 1);
	HAL_Delay(400);
	HAL_GPIO_WritePin(GPIOC, ISO9141_K, 0);
	HAL_Delay(400);
	HAL_GPIO_WritePin(GPIOC, ISO9141_K, 1);
	HAL_Delay(100);
}

HAL_StatusTypeDef iso9141_listen(void) {
	char* test = "This is a test";
	HAL_UART_Transmit(&huart4, test, strlen(test), 100);
	return HAL_OK;
}
